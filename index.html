<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chiefs Playoff Simulator</title>
    
    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; background-color: #f9fafb; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .touch-manipulation { touch-action: manipulation; }
        @keyframes live-pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        .live-indicator { animation: live-pulse 2s infinite; }
    </style>

    <!-- Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        //  APP VERSION
        // ==========================================
        const APP_VERSION = "v2.02"; 

        // ==========================================
        //  STEP 1: PASTE YOUR FIREBASE KEYS HERE
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyC1X5ojFe20AaRC1OMVpDoXbqtzi5j0s4Y",
            authDomain: "chiefs-tracker.firebaseapp.com",
            projectId: "chiefs-tracker",
            storageBucket: "chiefs-tracker.firebasestorage.app",
            messagingSenderId: "484287750268",
            appId: "1:484287750268:web:e3f84f1dbd0d371df929f9"
        };

        const { useState, useEffect, useMemo } = React;

        let db, auth;
        let isFirebaseActive = false;
        try {
            if (firebaseConfig.apiKey && typeof firebase !== 'undefined') {
                const app = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore(app);
                auth = firebase.auth(app);
                isFirebaseActive = true;
            }
        } catch (e) { console.warn("Offline Mode"); }

        // --- 1. FULL DATA ---
        const INITIAL_TEAMS = [
            { id: 'ne', name: 'Patriots', wins: 10, losses: 2, confWins: 6, confLosses: 1, divWins: 4, divLosses: 0, conf: 'AFC', division: 'East', logo: 'ðŸ¦' },
            { id: 'den', name: 'Broncos', wins: 9, losses: 2, confWins: 6, confLosses: 2, divWins: 2, divLosses: 1, conf: 'AFC', division: 'West', logo: 'ðŸ´' },
            { id: 'jax', name: 'Jaguars', wins: 8, losses: 4, confWins: 5, confLosses: 3, divWins: 3, divLosses: 1, conf: 'AFC', division: 'South', logo: 'ðŸ†' }, 
            { id: 'ind', name: 'Colts', wins: 8, losses: 4, confWins: 6, confLosses: 3, divWins: 2, divLosses: 2, conf: 'AFC', division: 'South', logo: 'ðŸŽ' },   
            { id: 'hou', name: 'Texans', wins: 7, losses: 5, confWins: 6, confLosses: 2, divWins: 3, divLosses: 1, conf: 'AFC', division: 'South', logo: 'ðŸ®' },  
            { id: 'lac', name: 'Chargers', wins: 7, losses: 4, confWins: 6, confLosses: 2, divWins: 2, divLosses: 1, conf: 'AFC', division: 'West', logo: 'âš¡' }, 
            { id: 'buf', name: 'Bills', wins: 7, losses: 4, confWins: 4, confLosses: 3, divWins: 2, divLosses: 1, conf: 'AFC', division: 'East', logo: 'ðŸ¦¬' },   
            { id: 'pit', name: 'Steelers', wins: 6, losses: 5, confWins: 5, confLosses: 2, divWins: 2, divLosses: 1, conf: 'AFC', division: 'North', logo: 'ðŸ”¨' }, 
            { id: 'bal', name: 'Ravens', wins: 6, losses: 6, confWins: 4, confLosses: 4, divWins: 1, divLosses: 3, conf: 'AFC', division: 'North', logo: 'ðŸ¦' },  
            { id: 'kc', name: 'Chiefs', wins: 6, losses: 6, confWins: 3, confLosses: 4, divWins: 2, divLosses: 1, conf: 'AFC', division: 'West', logo: 'ðŸ¹' },   
            { id: 'mia', name: 'Dolphins', wins: 4, losses: 7, confWins: 2, confLosses: 6, divWins: 1, divLosses: 3, conf: 'AFC', division: 'East', logo: 'ðŸ¬' },
            { id: 'cin', name: 'Bengals', wins: 4, losses: 8, confWins: 4, confLosses: 4, divWins: 1, divLosses: 3, conf: 'AFC', division: 'North', logo: 'ðŸ¯' },
            { id: 'nyj', name: 'Jets', wins: 3, losses: 8, confWins: 1, confLosses: 6, divWins: 0, divLosses: 3, conf: 'AFC', division: 'East', logo: 'âœˆï¸' },
            { id: 'cle', name: 'Browns', wins: 3, losses: 8, confWins: 2, confLosses: 6, divWins: 1, divLosses: 2, conf: 'AFC', division: 'North', logo: 'ðŸ¶' },
            { id: 'lv', name: 'Raiders', wins: 2, losses: 9, confWins: 1, confLosses: 7, divWins: 0, divLosses: 3, conf: 'AFC', division: 'West', logo: 'â˜ ï¸' },
            { id: 'ten', name: 'Titans', wins: 1, losses: 10, confWins: 0, confLosses: 7, divWins: 0, divLosses: 3, conf: 'AFC', division: 'South', logo: 'âš”ï¸' }
        ];

        // --- 2. SCHEDULE ---
        const FULL_SCHEDULE = {
            13: [
                { id: 'w13_kc_dal', home: 'Cowboys', away: 'Chiefs', interest: 'Chiefs', status: 'final', winner: 'home', score: '31-28', isConfGame: false },
                { id: 'w13_hou_ind', home: 'Colts', away: 'Texans', interest: 'Colts', status: 'final', winner: 'away', score: '16-20', isConfGame: true, isDivGame: true },
                { id: 'w13_jax_ten', home: 'Titans', away: 'Jaguars', interest: 'Titans', status: 'final', winner: 'away', score: '3-25', isConfGame: true, isDivGame: true },
                { id: 'w13_pit_buf', home: 'Steelers', away: 'Bills', interest: 'Bills', status: 'live', score: '10-7', reason: 'Knocks Steelers down to 6-6', isConfGame: true },
                { id: 'w13_lac_lv', home: 'Chargers', away: 'Raiders', interest: 'Raiders', status: 'live', score: '0-0', reason: 'Chargers hold tiebreaker over KC', isConfGame: true, isDivGame: true },
                { id: 'w13_den_was', home: 'Commanders', away: 'Broncos', interest: 'Commanders', status: 'scheduled', reason: 'Catching the division leader', isConfGame: false }
            ],
            14: [
                { id: 'w14_kc_hou', home: 'Chiefs', away: 'Texans', interest: 'Chiefs', status: 'scheduled', reason: 'MUST WIN GAME', isConfGame: true },
                { id: 'w14_buf_cin', home: 'Bills', away: 'Bengals', interest: 'Bengals', status: 'scheduled', reason: 'Bills are ahead of KC', isConfGame: true },
                { id: 'w14_lac_phi', home: 'Chargers', away: 'Eagles', interest: 'Eagles', status: 'scheduled', reason: 'Chargers are ahead of KC', isConfGame: false },
                { id: 'w14_jax_ind', home: 'Jaguars', away: 'Colts', interest: 'Colts', status: 'scheduled', reason: 'Jags are ahead of KC', isConfGame: true, isDivGame: true }
            ],
            15: [
                { id: 'w15_kc_lac', home: 'Chiefs', away: 'Chargers', interest: 'Chiefs', status: 'scheduled', reason: 'MUST WIN (Division & WC)', isConfGame: true, isDivGame: true },
                { id: 'w15_buf_ne', home: 'Patriots', away: 'Bills', interest: 'Patriots', status: 'scheduled', reason: 'Bills are ahead of KC', isConfGame: true, isDivGame: true },
                { id: 'w15_jax_nyj', home: 'Jaguars', away: 'Jets', interest: 'Jets', status: 'scheduled', reason: 'Jags are ahead of KC', isConfGame: true }
            ],
            16: [
                { id: 'w16_kc_ten', home: 'Titans', away: 'Chiefs', interest: 'Chiefs', status: 'scheduled', reason: 'MUST WIN', isConfGame: true },
                { id: 'w16_jax_den', home: 'Broncos', away: 'Jaguars', interest: 'Broncos', status: 'scheduled', reason: 'Jags are bigger threat to WC', isConfGame: true },
                { id: 'w16_lac_dal', home: 'Cowboys', away: 'Chargers', interest: 'Cowboys', status: 'scheduled', reason: 'Chargers are threat', isConfGame: false },
                { id: 'w16_pit_det', home: 'Lions', away: 'Steelers', interest: 'Lions', status: 'scheduled', reason: 'Steelers are threat', isConfGame: false },
                { id: 'w16_buf_cle', home: 'Browns', away: 'Bills', interest: 'Browns', status: 'scheduled', reason: 'Bills are threat', isConfGame: true },
                { id: 'w16_hou_lv', home: 'Texans', away: 'Raiders', interest: 'Raiders', status: 'scheduled', reason: 'Texans are threat', isConfGame: true }
            ],
            17: [
                { id: 'w17_kc_den', home: 'Chiefs', away: 'Broncos', interest: 'Chiefs', status: 'scheduled', reason: 'MUST WIN (Xmas Day)', isConfGame: true, isDivGame: true },
                { id: 'w17_lac_hou', home: 'Chargers', away: 'Texans', interest: 'Texans', status: 'scheduled', reason: 'Chargers hold tiebreaker over KC', isConfGame: true },
                { id: 'w17_buf_phi', home: 'Bills', away: 'Eagles', interest: 'Eagles', status: 'scheduled', reason: 'Bills are threat', isConfGame: false },
                { id: 'w17_jax_ind', home: 'Colts', away: 'Jaguars', interest: 'Colts', status: 'scheduled', reason: 'Jags are threat', isConfGame: true, isDivGame: true },
                { id: 'w17_pit_cle', home: 'Browns', away: 'Steelers', interest: 'Browns', status: 'scheduled', reason: 'Steelers are threat', isConfGame: true, isDivGame: true }
            ],
            18: [
                { id: 'w18_kc_lv', home: 'Raiders', away: 'Chiefs', interest: 'Chiefs', status: 'scheduled', reason: 'MUST WIN', isConfGame: true, isDivGame: true },
                { id: 'w18_den_lac', home: 'Broncos', away: 'Chargers', interest: 'Broncos', status: 'scheduled', reason: 'Chargers hold tiebreaker over KC', isConfGame: true, isDivGame: true },
                { id: 'w18_hou_ind', home: 'Texans', away: 'Colts', interest: 'Colts', status: 'scheduled', reason: 'Texans are threat', isConfGame: true, isDivGame: true },
                { id: 'w18_jax_ten', home: 'Jaguars', away: 'Titans', interest: 'Titans', status: 'scheduled', reason: 'Jags are threat', isConfGame: true, isDivGame: true },
                { id: 'w18_pit_bal', home: 'Steelers', away: 'Ravens', interest: 'Ravens', status: 'scheduled', reason: 'Steelers are threat', isConfGame: true, isDivGame: true },
                { id: 'w18_buf_nyj', home: 'Bills', away: 'Jets', interest: 'Jets', status: 'scheduled', reason: 'Bills are threat', isConfGame: true, isDivGame: true }
            ]
        };

        const Icon = ({ name, className }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        function App() {
            const [pulse, setPulse] = useState({ yes: 1240, no: 650, voted: false });
            const [localMode, setLocalMode] = useState(!isFirebaseActive);
            const [teams, setTeams] = useState(INITIAL_TEAMS);
            const [scenarios, setScenarios] = useState({});
            const [activeWeek, setActiveWeek] = useState(13);
            const [shareFeedback, setShareFeedback] = useState('');

            useEffect(() => {
                setScenarios(prev => {
                    let saved = {};
                    try {
                        const fromStorage = localStorage.getItem('chiefs_scenarios');
                        if (fromStorage) saved = JSON.parse(fromStorage);
                    } catch(e) {}
                    const combined = { ...saved };
                    Object.values(FULL_SCHEDULE).flat().forEach(game => {
                        if (game.status === 'final') {
                            combined[game.id] = game.winner; 
                        } else if (!combined[game.id]) {
                            combined[game.id] = game.interest === game.home ? 'home' : 'away';
                        }
                    });
                    return combined;
                });

                let unsubscribeSnapshot = () => {};
                if (isFirebaseActive) {
                    auth.onAuthStateChanged(user => {
                        if (user) {
                            unsubscribeSnapshot();
                            unsubscribeSnapshot = db.collection('stats').doc('chiefs_pulse')
                                .onSnapshot((doc) => {
                                    if (doc.exists) {
                                        const d = doc.data();
                                        setPulse(prev => ({ ...prev, yes: d.yes || 0, no: d.no || 0 }));
                                    }
                                }, () => setLocalMode(true));
                        } else {
                            auth.signInAnonymously().catch(() => setLocalMode(true));
                        }
                    });
                } else {
                    const saved = localStorage.getItem('chiefs_pulse_local');
                    if(saved) setPulse(JSON.parse(saved));
                }
                return () => unsubscribeSnapshot();
            }, []);

            useEffect(() => {
                if (Object.keys(scenarios).length > 0) {
                    localStorage.setItem('chiefs_scenarios', JSON.stringify(scenarios));
                }
            }, [scenarios]);

            // --- Calc: ADVANCED TIEBREAKERS ---
            const projectedStandings = useMemo(() => {
                let currentTeams = JSON.parse(JSON.stringify(teams));
                
                // 1. Process Explicit Games
                Object.values(FULL_SCHEDULE).flat().forEach(game => {
                    if (game.status === 'final') return;
                    if (!scenarios[game.id]) return;
                    const winnerSide = scenarios[game.id];
                    const homeTeam = currentTeams.find(t => t.name.includes(game.home) || game.home.includes(t.name));
                    const awayTeam = currentTeams.find(t => t.name.includes(game.away) || game.away.includes(t.name));
                    
                    if (homeTeam && awayTeam) {
                        if (winnerSide === 'home') { 
                            homeTeam.wins++; 
                            homeTeam.sov += awayTeam.wins; // Basic SOV calc
                            if(game.isConfGame) homeTeam.confWins++; 
                            if(game.isDivGame) homeTeam.divWins++; 
                        } else { 
                            homeTeam.losses++; 
                            if(game.isConfGame) homeTeam.confLosses++;
                            if(game.isDivGame) homeTeam.divLosses++; 
                        }
                    }
                    if (awayTeam) {
                        if (winnerSide === 'away') { 
                            awayTeam.wins++; 
                            awayTeam.sov += homeTeam.wins; // Basic SOV calc
                            if(game.isConfGame) awayTeam.confWins++;
                            if(game.isDivGame) awayTeam.divWins++;
                        } else { 
                            awayTeam.losses++; 
                            if(game.isConfGame) awayTeam.confLosses++;
                            if(game.isDivGame) awayTeam.divLosses++;
                        }
                    }
                });

                // 2. Filler Logic (Simulate to 17)
                currentTeams.forEach(team => {
                    const totalPlayed = team.wins + team.losses;
                    const remaining = 17 - totalPlayed;
                    if (remaining > 0) {
                        const currentPct = team.wins / (totalPlayed || 1);
                        const simWins = currentPct >= 0.5 ? Math.ceil(remaining * currentPct) : Math.floor(remaining * currentPct);
                        const simLosses = remaining - simWins;
                        team.wins += simWins;
                        team.losses += simLosses;
                        team.confWins += Math.round(simWins * 0.7);
                        team.confLosses += Math.round(simLosses * 0.7);
                        team.divWins += Math.round(simWins * 0.3);
                        team.divLosses += Math.round(simLosses * 0.3);
                    }
                    // Init SOV if undefined
                    if(!team.sov) team.sov = 0;
                });

                // 3. Sorting Engine
                const divisions = { 'East': [], 'West': [], 'North': [], 'South': [] };
                currentTeams.forEach(t => { if(divisions[t.division]) divisions[t.division].push(t); });

                let winners = [];
                let wildcards = [];

                // UNIVERSAL HEAD-TO-HEAD CHECK
                const checkHeadToHead = (a, b) => {
                    // Check if they played in schedule
                    let aWins = 0;
                    let bWins = 0;
                    
                    Object.values(FULL_SCHEDULE).flat().forEach(game => {
                        const isAHome = game.home.includes(a.name) || a.name.includes(game.home);
                        const isBHome = game.home.includes(b.name) || b.name.includes(game.home);
                        const isAAway = game.away.includes(a.name) || a.name.includes(game.away);
                        const isBAway = game.away.includes(b.name) || b.name.includes(game.away);

                        // Only if they played each other
                        if ((isAHome && isBAway) || (isBHome && isAAway)) {
                            // Check winner
                            let winner = null;
                            if (game.status === 'final') winner = game.winner;
                            else if (scenarios[game.id]) winner = scenarios[game.id];

                            if (winner) {
                                if ((isAHome && winner === 'home') || (isAAway && winner === 'away')) aWins++;
                                else bWins++;
                            }
                        }
                    });

                    // Add hardcoded past results (KC vs Bills, etc.)
                    // This is simplified for this demo, assumes schedule captures future games
                    // We maintain the hardcoded "Killers" list for pre-existing losses not in schedule array
                    const killers = ['Bills', 'Jaguars']; // Teams KC lost to before Week 13
                    if(a.id === 'kc' && killers.includes(b.name)) return -1;
                    if(b.id === 'kc' && killers.includes(a.name)) return 1;

                    if (aWins > bWins) return 1;
                    if (bWins > aWins) return -1;
                    return 0;
                };

                const sortTeams = (a, b, context = 'wildcard') => {
                    // 1. Win Percentage
                    const wa = a.wins/(a.wins+a.losses||1);
                    const wb = b.wins/(b.wins+b.losses||1);
                    if(Math.abs(wa-wb)>0.001) return wb-wa;

                    // 2. Head-to-Head (Universal)
                    const h2h = checkHeadToHead(a, b);
                    if (h2h !== 0) return h2h;
                    
                    // 3. Division Record (Context Dependent)
                    if (context === 'division' || a.division === b.division) {
                        const da = a.divWins/(a.divWins+a.divLosses||1);
                        const db = b.divWins/(b.divWins+b.divLosses||1);
                        if(Math.abs(da-db)>0.001) return db-da;
                    }

                    // 4. Conference Record
                    const ca = a.confWins/(a.confWins+a.confLosses||1);
                    const cb = b.confWins/(b.confWins+b.confLosses||1);
                    if(Math.abs(ca-cb)>0.001) return cb-ca;

                    // 5. Strength of Victory (SOV)
                    // Used as tiebreaker for deep ties
                    if (a.sov !== b.sov) return b.sov - a.sov;

                    return 0;
                };

                Object.values(divisions).forEach(divTeams => {
                    divTeams.sort((a,b) => sortTeams(a,b, 'division'));
                    if (divTeams.length > 0) {
                        winners.push(divTeams[0]);
                        for(let i=1; i<divTeams.length; i++) wildcards.push(divTeams[i]);
                    }
                });

                winners.sort((a,b) => sortTeams(a,b, 'wildcard'));
                wildcards.sort((a,b) => sortTeams(a,b, 'wildcard'));

                return [...winners, ...wildcards];
            }, [scenarios, teams]);

            const chiefsRank = projectedStandings.findIndex(t => t.name === 'Chiefs') + 1;
            const inPlayoffs = chiefsRank <= 7 && chiefsRank > 0;
            const chiefsStats = projectedStandings.find(t => t.name === 'Chiefs');

            const handleToggle = (gameId) => {
                const game = Object.values(FULL_SCHEDULE).flat().find(g => g.id === gameId);
                if (game && game.status === 'final') return;
                setScenarios(prev => ({...prev, [gameId]: prev[gameId] === 'home' ? 'away' : 'home'}));
            };

            const handleVote = async (type) => {
                if (pulse.voted) return;
                setPulse(prev => ({ ...prev, [type]: prev[type] + 1, voted: true }));
                if (isFirebaseActive) {
                    try { await db.collection('stats').doc('chiefs_pulse').set({ [type]: firebase.firestore.FieldValue.increment(1) }, { merge: true }); } catch(e){}
                } else {
                    const newState = { ...pulse, [type]: pulse[type] + 1, voted: true };
                    localStorage.setItem('chiefs_pulse_local', JSON.stringify(newState));
                }
            };

            const handleShare = async () => {
                const url = "https://surbo.github.io/chiefs-tracker/"; 
                if (navigator.share) { try { await navigator.share({ title: 'Chiefs Playoff Simulator', url: url }); return; } catch (err) {} }
                try { await navigator.clipboard.writeText(url); setShareFeedback('Link Copied!'); } catch (err) { setShareFeedback('Copy URL manually'); }
                setTimeout(() => setShareFeedback(''), 2500);
            };

            return (
                <div className="min-h-screen pb-20 overflow-x-hidden">
                    <div className="bg-red-700 text-white p-4 shadow-lg sticky top-0 z-30">
                        <div className="max-w-xl mx-auto flex items-center justify-between">
                            <div className="flex items-center space-x-2">
                                <Icon name="trophy" className="w-6 h-6 text-yellow-400" />
                                <h1 className="text-xl font-bold tracking-tight">Kingdom Tracker</h1>
                            </div>
                            <button onClick={handleShare} className="bg-white/10 hover:bg-white/20 p-2 rounded-full relative">
                                <Icon name="share-2" className="w-5 h-5" />
                                {shareFeedback && <div className="absolute top-10 right-0 bg-gray-900 text-white text-xs px-3 py-1.5 rounded-lg shadow-xl z-50">{shareFeedback}</div>}
                            </button>
                        </div>
                    </div>

                    <div className="max-w-xl mx-auto p-4 space-y-6">
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden relative">
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-400 to-red-600"></div>
                            <div className="p-5 text-center">
                                <h2 className="text-gray-400 text-xs font-bold uppercase tracking-wider mb-2">LIVE PROJECTION</h2>
                                <div className="flex justify-center items-end space-x-2 mb-2">
                                    <span className={`text-6xl font-black ${inPlayoffs ? 'text-green-600' : 'text-red-600'}`}>{chiefsRank || '--'}</span>
                                    <span className="text-xl font-bold text-gray-400 mb-2">seed</span>
                                </div>
                                <div className={`inline-flex items-center px-4 py-1.5 rounded-full text-sm font-bold shadow-sm ${inPlayoffs ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                    {inPlayoffs ? <Icon name="check-circle-2" className="w-4 h-4 mr-2"/> : <Icon name="x-circle" className="w-4 h-4 mr-2"/>}
                                    {inPlayoffs ? 'PLAYOFF BOUND' : 'ELIMINATED'}
                                </div>
                                <div className="mt-4 text-xs text-gray-400">Current Record: {chiefsStats?.wins}-{chiefsStats?.losses}*</div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-3 flex items-center justify-between select-none">
                            <button onClick={() => setActiveWeek(w => Math.max(13, w-1))} disabled={activeWeek === 13} className="p-3 bg-red-50 text-red-600 rounded-full disabled:opacity-30"><Icon name="chevron-left" className="w-6 h-6" /></button>
                            <div className="text-center"><span className="text-xs text-gray-400 font-bold block uppercase tracking-wide">SCHEDULE</span><span className="font-bold text-xl">Week {activeWeek}</span></div>
                            <button onClick={() => setActiveWeek(w => Math.min(18, w+1))} disabled={activeWeek === 18} className="p-3 bg-red-50 text-red-600 rounded-full disabled:opacity-30"><Icon name="chevron-right" className="w-6 h-6" /></button>
                        </div>

                        <div className="space-y-3">
                            {FULL_SCHEDULE[activeWeek]?.map((game) => {
                                const isHomeSelected = scenarios[game.id] === 'home';
                                const isFinal = game.status === 'final';
                                const isLive = game.status === 'live';
                                
                                return (
                                    <div key={game.id} className={`bg-white rounded-lg p-4 shadow-sm relative overflow-hidden transition-all duration-300 ${isLive ? 'border-2 border-green-500 shadow-[0_0_15px_rgba(34,197,94,0.15)]' : 'border border-gray-200'}`}>
                                        <div className="flex justify-between items-center mb-2">
                                            {isLive && (
                                                <div className="flex items-center space-x-1.5 bg-green-50 text-green-600 px-2 py-0.5 rounded-full border border-green-200">
                                                    <div className="w-2 h-2 bg-green-500 rounded-full live-indicator"></div>
                                                    <span className="text-[10px] font-black tracking-wider">LIVE</span>
                                                </div>
                                            )}
                                            {!isLive && <div className="h-4"></div>}
                                        </div>

                                        <div className="flex justify-between items-center mb-3 px-1">
                                            <div className="text-center w-1/3">
                                                <div className={`text-base font-bold ${isFinal ? (game.winner === 'home' ? 'text-gray-900' : 'text-gray-400') : (isHomeSelected ? 'text-gray-900' : 'text-gray-400')}`}>{game.home}</div>
                                            </div>
                                            <div className="text-xs text-gray-300 font-bold">VS</div>
                                            <div className="text-center w-1/3">
                                                <div className={`text-base font-bold ${isFinal ? (game.winner === 'away' ? 'text-gray-900' : 'text-gray-400') : (!isHomeSelected ? 'text-gray-900' : 'text-gray-400')}`}>{game.away}</div>
                                            </div>
                                        </div>

                                        {isFinal ? (
                                            <div className="bg-gray-100 rounded-lg p-3 mb-3 flex flex-col items-center justify-center border border-gray-200">
                                                <span className="text-[10px] font-black tracking-widest text-gray-400 uppercase mb-1">FINAL SCORE</span>
                                                <span className="text-xl font-black text-gray-800">{game.score}</span>
                                            </div>
                                        ) : (
                                            <div className="flex items-center justify-between bg-gray-100 rounded-lg p-1 mb-3">
                                                <button onClick={() => handleToggle(game.id)} className={`flex-1 text-xs py-3 rounded-md font-bold transition-all duration-200 touch-manipulation ${isHomeSelected ? 'bg-white shadow text-gray-900' : 'text-gray-500 hover:text-gray-700'}`}>{game.home} Wins</button>
                                                <button onClick={() => handleToggle(game.id)} className={`flex-1 text-xs py-3 rounded-md font-bold transition-all duration-200 touch-manipulation ${!isHomeSelected ? 'bg-white shadow text-gray-900' : 'text-gray-500 hover:text-gray-700'}`}>{game.away} Wins</button>
                                            </div>
                                        )}

                                        <div className="flex items-start space-x-2 bg-blue-50 p-2 rounded text-blue-800">
                                            <Icon name="info" className="w-4 h-4 mt-0.5 flex-shrink-0" />
                                            <div className="text-xs leading-relaxed"><span className="font-bold">Root for {game.interest}: </span>{game.reason}</div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        <div>
                            <h2 className="text-lg font-bold mb-3 flex items-center text-gray-800"><Icon name="activity" className="w-5 h-5 mr-2 text-red-600"/> Live AFC Standings*</h2>
                            <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                <table className="w-full text-sm">
                                    <thead className="bg-gray-50 text-gray-500 text-xs uppercase font-semibold">
                                        <tr><th className="px-4 py-3 text-left w-8">#</th><th className="px-4 py-3 text-left">Team</th><th className="px-4 py-3 text-right">Rec</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {projectedStandings.map((team, idx) => {
                                            const rank = idx + 1;
                                            const isChiefs = team.name === 'Chiefs';
                                            return (
                                                <React.Fragment key={team.id}>
                                                    <tr className={`${isChiefs ? 'bg-red-50' : 'bg-white'} ${rank <= 7 ? 'text-gray-900' : 'text-gray-400'} ${rank === 4 ? 'border-b-4 border-gray-200' : ''}`}>
                                                        <td className="px-4 py-3 font-bold text-gray-500">{rank}</td>
                                                        <td className="px-4 py-3 flex items-center font-medium"><span className="mr-2 text-xl">{team.logo}</span><div className="flex flex-col"><span className={isChiefs ? 'text-red-700 font-bold text-base' : ''}>{team.name}</span>{isChiefs && rank > 7 && <span className="text-[10px] text-red-500 font-bold uppercase">In the Hunt</span>}</div></td>
                                                        <td className="px-4 py-3 text-right tabular-nums font-bold">{team.wins}-{team.losses}</td>
                                                    </tr>
                                                    {rank === 7 && <tr className="bg-gray-800 text-white"><td colSpan="3" className="px-4 py-1 text-[10px] text-center font-bold uppercase tracking-widest">Playoff Cutoff Line</td></tr>}
                                                </React.Fragment>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div className="bg-gray-900 rounded-xl p-6 text-white shadow-lg">
                            <div className="flex items-center justify-between mb-4">
                                <div><h3 className="text-lg font-bold">Kingdom Pulse</h3><div className="flex items-center space-x-2"><p className="text-gray-400 text-xs">Join other fans.</p>{localMode && <span className="text-[10px] bg-gray-700 px-1.5 rounded text-gray-300 flex items-center">Offline Mode</span>}</div></div>
                                <Icon name="calendar" className="text-gray-600 w-8 h-8" />
                            </div>
                            <div className="flex space-x-3 mb-4">
                                <button onClick={() => handleVote('yes')} disabled={pulse.voted} className={`flex-1 py-3 rounded-lg font-bold text-sm transition-transform active:scale-95 border border-white/10 touch-manipulation flex justify-center items-center ${pulse.voted ? 'bg-green-600/20 text-white/50' : 'bg-green-600 hover:bg-green-500'}`}>BELIEVE ðŸš€</button>
                                <button onClick={() => handleVote('no')} disabled={pulse.voted} className={`flex-1 py-3 rounded-lg font-bold text-sm transition-transform active:scale-95 border border-white/10 touch-manipulation flex justify-center items-center ${pulse.voted ? 'bg-red-600/20 text-white/50' : 'bg-red-600 hover:bg-red-500'}`}>IT'S OVER ðŸ’€</button>
                            </div>
                            <div className="space-y-2">
                                <div className="flex justify-between text-xs font-semibold mb-1 text-gray-400"><span>Optimists ({Math.round((pulse.yes / ((pulse.yes + pulse.no) || 1)) * 100)}%)</span><span>Doomers ({Math.round((pulse.no / ((pulse.yes + pulse.no) || 1)) * 100)}%)</span></div>
                                <div className="w-full h-2 bg-gray-800 rounded-full overflow-hidden flex"><div className="bg-green-500 h-full transition-all duration-500" style={{ width: `${(pulse.yes / ((pulse.yes + pulse.no) || 1)) * 100}%` }}></div><div className="bg-red-500 h-full transition-all duration-500" style={{ width: `${(pulse.no / ((pulse.yes + pulse.no) || 1)) * 100}%` }}></div></div>
                            </div>
                        </div>
                        <div className="mt-8 text-center text-xs text-gray-400 pb-8">
                            * Includes auto-projections for unlisted games to reach 17 total
                            <div className="mt-2 font-mono opacity-50">Version {APP_VERSION}</div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
